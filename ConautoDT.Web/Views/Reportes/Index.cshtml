
@model VET_ANIMAL.WEB.Models.MascotasViewModel
@{
    ViewData["Title"] = "Reportes";
}
<html lang="es">
<head>
    <!-- Metadatos, título y otros elementos del head -->

    <!-- Enlaces a las hojas de estilo CSS -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="~/css/bootstrap-multiselect.css" />
</head>
<body>
    <div class="row" style="font-size: 13px !important;">
        <div class="col-md-12">
            <div class="widget">
                <header class="widget-header " style="padding-bottom: 5px !important;">
                    <div class="row">
                        <h4 class="widget-title col-md-12" style="font-weight:400 !important;font-size: 29px; color: black;font-family: 'Young Serif', sans-serif;">Reporte Incidencia de la Enfermedad</h4>
                    </div>
                    <form asp-action="ReporteInspeccionLlantas" style="font-family: 'Young Serif', sans-serif; ">
                        <div class="container-fluid alert alert-info mt-3">
                            <div class="row">
                                <div class="col-md-4 col-sm-12 mb-2">
                                    <div class="input-group">
                                        <label class="form-label me-3" for="desde">Desde:</label>
                                        <input type="date" id="desde" asp-for="@Model.Filtro.desde" class="form-control" />
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-12 mb-2 ">
                                    <div class="input-group">
                                        <label class="form-label me-3" for="hasta">Hasta:</label>
                                        <input type="date" id="hasta" asp-for="@Model.Filtro.hasta" class="form-control" />
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-12 mb-2">
                                    <div class="input-group">
                                        <label class="form-label me-3" for="parametroMascota">Parámetro Mascota:</label>
                                        <div class="dropdown">
                                            <button class="btn btn-success btn-sm" type="button" id="dropdownMenuButton" aria-haspopup="true" aria-expanded="false">
                                                Seleccionar Parámetro
                                            </button>
                                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                                <div class="form-check m-2">
                                                    <input class="form-check-input" type="checkbox" id="checkRAZA" value="RAZA">
                                                    <label class="form-check-label" for="checkRAZA">RAZA</label>
                                                </div>
                                                <div class="form-check m-2">
                                                    <input class="form-check-input" type="checkbox" id="checkSEXO" value="SEXO">
                                                    <label class="form-check-label" for="checkSEXO">SEXO</label>
                                                </div>
                                                <div class="form-check m-2">
                                                    <input class="form-check-input" type="checkbox" id="checkDIAGNOSTICO" value="DIAGNOSTICO">
                                                    <label class="form-check-label" for="checkDIAGNOSTICO">DIAGNOSTICO</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                             
                            </div>

                        
                        </div>
                        <div class="container-fluid alert alert-success mt-3">
                            <div class="row">
                                <div id="10" class="col-md-4 col-sm-12 mb-2" hidden>
                                    <div class="form-floating">
                                        <select asp-for="@Model.raza" class="form-control" id="editRaza" style="color: blue;font-size: 16px;">
                                            <option value="">Seleccione</option>
                                            <!-- Las opciones se agregarán dinámicamente aquí -->
                                        </select>
                                        <label for="editRaza">Raza</label>
                                    </div>
                                </div>
                                <div id="11" class="col-md-4 col-sm-12 mb-2 " hidden>
                                    <div class="form-floating">
                                        <select asp-for="@Model.sexo" class="form-control" id="verificarsexo" style="color: blue;font-size: 16px;">
                                            <option value="">Seleccione</option>
                                            <option value="Macho">Macho</option>
                                            <option value="Hembra">Hembra</option>
                                        </select>
                                        <label for="verificarsexo">Sexo</label>
                                    </div>
                                </div>

                                <div id="12" class="col-md-4 col-sm-12 mb-2" hidden>
                                    <div class="form-floating">
                                        <select asp-for="@Model.sexo" class="form-control" id="enfermedad" style="color: blue;font-size: 16px;">
                                            <option value="">Seleccione</option>
                                        </select>
                                        <label for="enfermedad">Diagnóstico</label>
                                    </div>
                                </div>

                            </div>


                        </div>
                        <div class="row">
                            <div class="col-md-3 col-sm-12 mb-2 mx-auto">
                                <!-- Botón Filtrar -->
                                <button id="Filtrar" type="submit" class="btn btn-primary btn-block">Filtrar</button>
                            </div>
                            <div class="col-md-3 col-sm-12 mb-2 mx-auto">
                                <!-- Botón Descargar Excel -->
                                <button type="submit" name="operacion" value="excel" class="btn btn-success btn-block">
                                    <i class="zmdi zmdi-download" title="Descargar Excel"></i> Descargar Excel
                                </button>
                            </div>
                        </div>
                    </form>
                </header>
                <div class="widget-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm  dataTable" id="tablaMascotas">

                            <thead>
                                <tr>
                                    <th>
                                        Historia Clinica
                                    </th>
                                    <th>
                                        Nombre Mascota
                                    </th>
                                    <th>
                                        Raza
                                    </th>
                                    <th>
                                        Edad
                                    </th>
                                    <th>
                                        Peso
                                    </th>
                                    <th>
                                        Sexo
                                    </th>
                                    <th>
                                        Diagnóstico
                                    </th>


                                </tr>
                            </thead>
                            @* <tbody>

                                @if (Model.ListaInspeccion != null)
                                {


                                    @foreach (var item in Model.ListaInspeccion)
                                    {
                                        @Html.HiddenFor(model => item.idLlanta)
                                        ;
                                        @Html.HiddenFor(model => item.idEstadoLLanta)
                                        ;
                                        @Html.HiddenFor(model => item.idTipoVehiculo)
                                        ;
                                        @Html.HiddenFor(model => item.idLLantaInspe)
                                        ;
                                        @Html.HiddenFor(model => item.idMarcaLLanta)
                                        ;
                                        @Html.HiddenFor(model => item.idMedidaLLanta)
                                        ;
                                        @Html.HiddenFor(model => item.idDisenioLLanta)
                                        ;


                                        ;

                                        <tr>
                                            <td>
                                                @Html.DisplayFor(model => item.idHistoInspeLlanta)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(model => item.termico)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(model => item.placa)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(model => item.estadoLlanta)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(model => item.tipoVehiculo)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(model => item.numeroPosicion)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(model => item.posicion)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(model => item.fechaInspeccion)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(model => item.marcaLlanta)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(model => item.medidaLlanta)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(model => item.disenioLlanta)
                                            </td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td>No existen datos para mostrar</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>

                                }
                            </tbody> *@

                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>



</body>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.js"></script>
    <script type="text/javascript" src="~/js/bootstrap-multiselect.js"></script>
    <script type="text/javascript">

        document.addEventListener('DOMContentLoaded', function () {
            var dropdownMenuButton = document.getElementById('dropdownMenuButton');
            var checkboxes = document.querySelectorAll('.form-check-input');

            // Agregar evento de cambio a cada checkbox
            checkboxes.forEach(function (checkbox) {
                checkbox.addEventListener('change', function () {
                    // Verificar si todos los checkboxes están marcados
                    var allChecked = Array.from(checkboxes).every(function (cb) {
                        return cb.checked;
                    });

                    // Si todos los checkboxes están marcados, cerrar el menú desplegable
                    if (allChecked) {
                        var dropdownMenu = dropdownMenuButton.nextElementSibling;
                        dropdownMenu.classList.remove('show');
                    }
                });
            });

            // Activar el menú desplegable al hacer clic en el botón
            dropdownMenuButton.addEventListener('click', function () {
                var dropdownMenu = dropdownMenuButton.nextElementSibling;
                dropdownMenu.classList.toggle('show');
            });
        });

            $(document).ready(function () {
                $('#tablaInspeccion').DataTable();
            });

        $(document).ready(function () {
            $('#checkRAZA').change(function () {
                if ($(this).is(':checked')) {
                    $('#10').removeAttr('hidden');
                } else {
                    $('#10').attr('hidden', true);
                }
            });

            $('#checkSEXO').change(function () {
                if ($(this).is(':checked')) {
                    $('#11').removeAttr('hidden');
                } else {
                    $('#11').attr('hidden', true);
                }
            });

            $('#checkDIAGNOSTICO').change(function () {
                if ($(this).is(':checked')) {
                    $('#12').removeAttr('hidden');
                } else {
                    $('#12').attr('hidden', true);
                }
            });
        });

        $(document).ready(function () {
            buscarRazas(); // Llamada a la función buscarRazas() cuando el DOM esté listo
        });

        $(document).ready(function () {
            buscarDiagnostico(); // Llamada a la función buscarRazas() cuando el DOM esté listo
        });

        function buscarRazas() {
            $.ajax({
                url: '/Razas/ListaRazas', // Ruta al método que devuelve la lista de razas
                method: 'GET',
                success: function (data) {
                    // Manipula los datos recibidos aquí
                    console.log("Datos de las razas:", data);

                    // Obtener el elemento select donde se colocarán las razas
                    var selectRazas = $("#editRaza");

                    // Limpiar los select antes de agregar nuevas opciones
                    selectRazas.empty();

                    // Agregar una opción predeterminada a cada select
                    selectRazas.append($('<option>', {
                        value: '',
                        text: 'Seleccione'
                    }));
                    

                    // Iterar sobre los datos recibidos y agregar opciones a cada select
                    $.each(data, function (index, raza) {
                        // Crear una nueva opción para cada raza
                        var option = $('<option>', {
                            value: raza.id, // Suponiendo que cada raza tiene un campo "id"
                            text: raza.descripcion // Suponiendo que cada raza tiene un campo "descripcion"
                        });

                        // Agregar la opción a cada select
                        selectRazas.append(option.clone());
                       
                    });

                },
                error: function (error) {
                    console.error('Error en la solicitud AJAX:', error);
                }
            });
        }

        function buscarDiagnostico() {
            $.ajax({
                url: '/Reportes/ListaDiagnostico', // Ruta al método que devuelve la lista de razas
                method: 'GET',
                success: function (data) {
                    // Manipula los datos recibidos aquí
                    console.log("Datos de las Diagnostico:", data);

                    // Obtener el elemento select donde se colocarán las razas
                    var selectRazas = $("#enfermedad");
                    

                    // Limpiar los select antes de agregar nuevas opciones
                    selectRazas.empty();
                    

                    // Agregar una opción predeterminada a cada select
                    selectRazas.append($('<option>', {
                        value: '',
                        text: 'Seleccione'
                    }));
                    

                    // Iterar sobre los datos recibidos y agregar opciones a cada select
                    $.each(data, function (index, enfermedad) {
                        // Crear una nueva opción para cada raza
                        var option = $('<option>', {
                            value: enfermedad.idEnfermedad, // Suponiendo que cada raza tiene un campo "id"
                            text: enfermedad.nombre // Suponiendo que cada raza tiene un campo "descripcion"
                        });

                        // Agregar la opción a cada select
                        selectRazas.append(option.clone());
                       
                    });

                },
                error: function (error) {
                    console.error('Error en la solicitud AJAX:', error);
                }
            });
        }
        </script>

}